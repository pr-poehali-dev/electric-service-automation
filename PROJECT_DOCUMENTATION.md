# –£–°–õ–£–ì–ò –≠–õ–ï–ö–¢–†–ò–ö–ê ORG - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–∞–∂–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Telegram Web App, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Planfix/Google Tasks –∏ –≤–µ–±-–ø–æ—Ä—Ç–∞–ª–æ–º –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

**–¢–∞–±–ª–∏—Ü—ã:**
- `clients` - –∫–ª–∏–µ–Ω—Ç—ã (telegram_id, phone, name)
- `executors` - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏/–º–∞—Å—Ç–µ—Ä–∞ (name, phone, rating, experience_years, location)
- `services` - —É—Å–ª—É–≥–∏ (name, description, base_price, category)
- `orders` - –∑–∞–∫–∞–∑—ã (client_id, executor_id, status, address, scheduled_date, total_price, planfix_task_id, google_task_id)
- `order_services` - —Å–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ –∏ —É—Å–ª—É–≥ (many-to-many)
- `order_status_history` - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `reviews` - –æ—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
- `admin_users` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤:**
- `new` - –Ω–æ–≤–∞—è –∑–∞—è–≤–∫–∞
- `assigned` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –º–∞—Å—Ç–µ—Ä—É
- `in_progress` - –≤ —Ä–∞–±–æ—Ç–µ
- `on_way` - –º–∞—Å—Ç–µ—Ä –≤—ã–µ—Ö–∞–ª
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω–∞

### 2. Backend API (Cloud Functions)

#### GET /get-services
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è Telegram Web App

**–û—Ç–≤–µ—Ç:**
```json
{
  "services": [
    {
      "id": 1,
      "name": "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–∑–µ—Ç–∫–∏",
      "description": "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–π —Ä–æ–∑–µ—Ç–∫–∏",
      "base_price": 500,
      "category": "installation"
    }
  ]
}
```

**URL:** https://functions.poehali.dev/46dcbdcd-c306-4a31-b776-f6e34eba609f

#### POST /create-order
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "telegram_id": 123456789,
  "client_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "phone": "+79001234567",
  "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10, –∫–≤. 5",
  "services": [
    {"service_id": 1, "quantity": 2, "price": 500}
  ],
  "scheduled_date": "2025-11-15",
  "scheduled_time": "14:00",
  "notes": "–ü–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞ —á–∞—Å"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "order_id": 1,
  "message": "Order created successfully"
}
```

**URL:** https://functions.poehali.dev/5c3c68df-2e41-4012-81fd-e134547810fb

#### GET /get-order-status
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `?order_id=1`

**–û—Ç–≤–µ—Ç:**
```json
{
  "order_id": 1,
  "status": "in_progress",
  "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10, –∫–≤. 5",
  "total_price": 1800,
  "executor": {
    "name": "–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤",
    "phone": "+79991234567",
    "rating": 4.9,
    "location": {"lat": 54.7104, "lng": 20.4522}
  },
  "services": [...],
  "history": [...]
}
```

**URL:** https://functions.poehali.dev/b875ba9a-3e1c-4e76-807f-0525f61dd331

#### POST /update-order-status
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ (–¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–æ–≤)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "order_id": 1,
  "status": "in_progress",
  "comment": "–ú–∞—Å—Ç–µ—Ä –≤—ã–µ—Ö–∞–ª",
  "changed_by": "executor_1"
}
```

**URL:** https://functions.poehali.dev/9fde3ede-6010-4014-95a9-ec4e7388f476

### 3. Frontend

#### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (/)
- –ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥
- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ö–æ—Ä–∑–∏–Ω–∞ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

#### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (/admin)
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è—Ö
- –î–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

#### 1. Telegram Web App
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–∫–∞–∑–∞ —É—Å–ª—É–≥
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞

#### 2. Planfix API
**Endpoint:** https://api.planfix.ru/xml/
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

#### 3. Google Tasks API
**Endpoint:** https://tasks.googleapis.com/tasks/v1/
- –í–∏–¥–∂–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã

#### 4. WhatsApp Business API
**Endpoint:** https://api.whatsapp.com/send
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –ß–∞—Ç —Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –∑–∞–∫–∞–∑

1. –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram Web App
2. POST /create-order ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
3. Webhook ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ Planfix/Google Tasks
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–ø–æ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)
5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é (Telegram/WhatsApp)
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –º–∞—Å—Ç–µ—Ä–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ Google Tasks
2. Webhook ‚Üí POST /update-order-status
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î + –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ –Ω–æ–≤–æ–º —Å—Ç–∞—Ç—É—Å–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞–¥–∞—á—É
2. POST /update-order-status (status: completed)
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É —Å –ø—Ä–æ—Å—å–±–æ–π –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ reviews
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- Telegram Web App: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –æ—Ç Telegram
- Admin –ø–∞–Ω–µ–ª—å: OAuth/OpenID (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- API endpoints: X-Auth-Token header –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- HTTPS –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤

### –ê—É–¥–∏—Ç
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ order_status_history
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, –∫—Ç–æ –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å
- Timestamp –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Timeweb

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:
1. Backend –∫–æ–¥ (Python 3.11)
2. Migrations (db_migrations/)
3. Frontend build (dist/)
4. .env —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
DATABASE_URL=postgresql://user:pass@host:5432/dbname
TELEGRAM_BOT_TOKEN=your_token
PLANFIX_API_KEY=your_key
GOOGLE_API_KEY=your_key
WHATSAPP_API_KEY=your_key
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:
```dockerfile
FROM python:3.11
WORKDIR /app
COPY backend/ .
RUN pip install -r requirements.txt
CMD ["python", "main.py"]
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ KPI

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –†–µ–π—Ç–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∑–∞–∫–∞–∑–æ–≤

### –ê–ª–µ—Ä—Ç—ã:
- –ó–∞–∫–∞–∑—ã –≤ —Å—Ç–∞—Ç—É—Å–µ "new" –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç
- –ù–∏–∑–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (<4.0)
- –û—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

### MVP (–ì–æ—Ç–æ–≤–æ)
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ Backend API –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

### –≠—Ç–∞–ø 2 (–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram Web App
‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Planfix API
‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google Tasks
‚è≥ WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 3 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–æ–≤
üìã –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç—ã
üìã –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
üìã –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤
üìã –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã

Telegram: @konigelectric
–¢–µ–ª–µ—Ñ–æ–Ω: +7 (4012) 52-07-25
